{% extends 'base.html' %}
{% load static %}

{% block content %}
	<h2>My Games</h2>
	<h3> New Game </h3>
	<input type="text" id="newName">
	<input type="button" id="newGame" value="Create Game">
	{% csrf_token %}
	<h3>Games</h3>
	<ul id="list">
		{% for id, name in data.items %}
			<li id="l{{ id }}">
				{{ name }}
				<a role="button" value="{{ id }}" class="delete" name="{{ name }}" id="d{{ id }}"><img src="{% static '/game/img/icon-deletelink.svg' %}"></a>
				<a role="button" value="{{ id }}" class="edit" name="{{ name }}" id="e{{ id }}"><img src="{% static '/game/img/icon-changelink.svg' %}"></a>
				<a role="button" value="{{ id }}" class="play" name="{{ name }}" id="p{{ id }}"><img src="{% static '/game/img/icon-play.svg' %}"></a>
			</li>
		{% empty %}
			<li>No games yet.</li>
		{% endfor %}
	</ul>
{% endblock %}

{% block extra_js %}
	<script>
		$("#list").on('click', '.edit', (e) => {
			console.log($(this).attr('value'))
			// var token = $("input[name=csrfmiddlewaretoken]").val();
			// var questionIds = [];
			// $.each($("input[class='question']:checked"), function(){
			// 	// questionIds.push($(this).val());
			// 	qName = $(this).attr('name');
			// 	qId = $(this).attr('id');
			// 	qValue = $(this).val();
			// 	timeDropdown = $("#t" + qId);
			// 	timeValue = timeDropdown.val();
			// 	questionIds.push({'id':Number(qId), 'time':Number(timeValue)})
			// });
			// console.log(questionIds);
			// console.log($("#name").val());
			// $.ajax({
			// 	type: "POST",
			// 	url: "/game/questions/",
			// 	data : {
			// 		csrfmiddlewaretoken: token, 
			// 		selected: JSON.stringify(questionIds), 
			// 		gameName: $("#name").val(),
			// 	},
			// 	success: function(data) {
			// 		console.log(data)
			// 	},
			// 	dataType: 'json',
			// });
		});
		$("#list").on('click', '.delete', (e) => {
			var token = $("input[name=csrfmiddlewaretoken]").val();
			console.log(token)
			id = $(this).attr('value');
			name = $(this).attr('name')
			var confirmed = confirm(`delete ${name}?`);
			if(confirmed) {
				$(`#l${id}`).remove();
				$.ajax({
					type: "DELETE",
					url: "/game/",
					beforeSend: function(xhr) {
						xhr.setRequestHeader("X-CSRFToken", token);
    				},
					data : {
						id: id, 
					},
					success: function(data) {
						console.log(data)
					},
					dataType: 'json',
				});
			}
		});
		$("#list").on('click', '.play', (e) => {
			id = $(this).attr('value');
			name = $(this).attr('name')
			console.log(`play ${name}`)
		});
		$("#newGame").click( (e) => {
			name = $("#newName").val()
			if(name.length == 0) {alert('nope'); return;}
			var token = $("input[name=csrfmiddlewaretoken]").val();
			console.log(name);
			$.ajax({
				type: "POST",
				url: "/game/",
				data : {
					csrfmiddlewaretoken: token,
					name: name
				},
				success: function(data) {
					id = data.id
					name = data.name
					console.log(data)
					var ul = $("#list");
					ul.append(
						`<li id='l${id}'>
							${name}
							<a role="button" value="${id}" class="delete" name="${name}" id="d${id}"><img src="{% static '/game/img/icon-deletelink.svg' %}"></a>
							<a role="button" value="${id}" class="edit"   name="${name}" id="e${id}"><img src="{% static '/game/img/icon-changelink.svg' %}"></a>
							<a role="button" value="${id}" class="play"   name="${name}" id="p${id}"><img src="{% static '/game/img/icon-play.svg' %}"></a>
						</li>`
					);
				},
				dataType: 'json',
			});
		});
	</script>
{% endblock extra_js %}