{% extends 'base.html' %}
{% load static %}

{% block content %}
	<h2>My Games</h2>
	<h3> New Game </h3>
	<input type="text" id="newName">
	<input type="button" id="newGame" value="Create Game">
	{% csrf_token %}
	<h3>Games</h3>
	<ul id="list">
		{% for id, name in data.items %}
			<li id="l{{ id }}">
				{{ name }}
				<a role="button" value="{{ id }}" class="delete" name="{{ name }}" id="d{{ id }}"><img src="{% static '/game/img/icon-deletelink.svg' %}"></a>
				<a href="/game/edit/{{ id }}" value="{{ id }}" class="edit" name="{{ name }}" id="e{{ id }}"><img src="{% static '/game/img/icon-changelink.svg' %}"></a>
				<a role="button" value="{{ id }}" class="play" name="{{ name }}" id="p{{ id }}"><img src="{% static '/game/img/icon-play.svg' %}"></a>
			</li>
		{% empty %}
			<li>No games yet.</li>
		{% endfor %}
	</ul>
	<h2>Public Games</h2>
	<input type="text" id="searchGame" value="Search for a Game">

{% endblock %}

{% block extra_js %}
	<script>
		$("#list").on('click', '.edit', (e) => {
			id = $(e.currentTarget).attr('value')
			name = $(e.currentTarget).attr('name')
			console.log(id)
		});
		$("#list").on('click', '.delete', (e) => {
			var token = $("input[name=csrfmiddlewaretoken]").val();
			id = $(e.currentTarget).attr('value')
			name = $(e.currentTarget).attr('name')
			// id = $(this).attr('value');
			// name = $(this).attr('name')
			var confirmed = confirm(`delete ${name}?`);
			console.log(id);
			if(confirmed) {
				$(`#l${id}`).remove();
				$.ajax({
					type: "DELETE",
					url: "/game/",
					beforeSend: function(xhr) {
						xhr.setRequestHeader("X-CSRFToken", token);
    				},
					data : {
						id: id, 
					},
					success: function(data) {
						console.log(data)
					},
					dataType: 'json',
				});
			}
		});
		$("#list").on('click', '.play', (e) => {
			id = $(e.currentTarget).attr('value')
			name = $(e.currentTarget).attr('name')
			// id = $(this).attr('value');
			// name = $(this).attr('name')
			console.log(`play ${name}`)
		});
		$("#newGame").click( (e) => {
			name = $("#newName").val()
			if(name.length == 0) {
				$('#newName').css('border-color', 'red');
				alert('name is required'); 
				return;
			}
			var token = $("input[name=csrfmiddlewaretoken]").val();
			console.log(name);
			$.ajax({
				type: "POST",
				url: "/game/",
				data : {
					csrfmiddlewaretoken: token,
					name: name
				},
				success: function(data) {
					id = data.id
					name = data.name
					console.log(data)
					var ul = $("#list");
					ul.append(
						`<li id='l${id}'>
							${name}
							<a role="button" value="${id}" class="delete" name="${name}" id="d${id}"><img src="{% static '/game/img/icon-deletelink.svg' %}"></a>
							<a role="button" value="${id}" class="edit"   name="${name}" id="e${id}"><img src="{% static '/game/img/icon-changelink.svg' %}"></a>
							<a role="button" value="${id}" class="play"   name="${name}" id="p${id}"><img src="{% static '/game/img/icon-play.svg' %}"></a>
						</li>`
					);
					$('#newName').val('');
				},
				dataType: 'json',
			});
		});
	</script>
{% endblock extra_js %}